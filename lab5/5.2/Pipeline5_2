pipeline {
  agent {
    kubernetes {
      //cloud 'kubernetes'
      //defaultContainer ''
      yaml """
kind: Pod
spec:
  containers:
  - name: run-artifact
    image: iptcp/gradle-app:0.1
    imagePullPolicy: IfNotPresent
    command: ["sleep"]
    args: ["300"]
"""
    }
  }
  environment {
        CREDENTIALS_ID ='simple-pipeline-app'
        BUCKET = 'simple-pipeline-artifact2'
        PATTERN = 'app/build/distributions/*.tar'
        LOCAL_DIR = '/tmp'
    }
    stages {
        stage('Download from GCS') {
            steps{
                // Download from GCS bucket object named PATTERN to directory LOCAL_DIR.
                step([$class: 'DownloadStep', credentialsId: env
                        .CREDENTIALS_ID,  bucketUri: "gs://${env.BUCKET}/${env.PATTERN}",
                      localDirectory: env.LOCAL_DIR])
            }
        }
        stage('Run artifact') {
            steps{
              echo "Unpacking artifact"
              sh 'tar -xvf /tmp/app/build/distributions/app.tar'
              echo "Running artifact"
              sh './app/bin/app'
            }
        }
    }
}
      