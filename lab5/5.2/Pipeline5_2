pipeline {
  agent {
    kubernetes {
      yaml """\
        apiVersion: v1
        kind: Pod
        metadata:
          labels:
            app: simple-app
        spec:
          containers:
          - name: app
            image: iptcp/gradle-app:0.3
            command:
            - cat
            tty: true
        """.stripIndent()
    }
  }
  environment {
        CREDENTIALS_ID ='simple-pipeline-app'
        BUCKET = 'simple-pipeline-artifact2'
        PATTERN = 'app/build/distributions/*.tar'
        LOCAL_DIR = '/tmp'
    }
  stages {
    stage('Download from GCS') {
      steps {
        container('app') {
         step([$class: 'DownloadStep', credentialsId: env
                        .CREDENTIALS_ID,  bucketUri: "gs://${env.BUCKET}/${env.PATTERN}",
                      localDirectory: env.LOCAL_DIR])
         sh 'ls -alR /home/gradle'
        }
      }  
    }
    stage('Run artifact') {
      steps {
        container('app') {
         echo "Checking java version"
              sh 'java -version'
              sh 'ls -alR /tmp'
        }
      }  
    }
  }
}