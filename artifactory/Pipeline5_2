@Library('simple-pipeline')_
pipeline {
  agent {
    kubernetes {
      yaml """\
        apiVersion: v1
        kind: Pod
        metadata:
          labels:
            app: simple-app
        spec:
          containers:
          - name: app
            image: iptcp/gradle-app:0.3
            command:
            - cat
            tty: true
        """.stripIndent()
    }
  }
  /*environment {
        CREDENTIALS_ID ='simple-pipeline-app'
        BUCKET = 'simple-pipeline-artifact2'
        PATTERN = 'app/build/distributions/*.tar'
        LOCAL_DIR = '.'
    }*/
  stages {
    stage('Download from GCS') {
      steps {
        build job: "artifactory-5.1/main", propagate: true, wait: true
          rtDownload (
    serverId: 'itlabs',
    spec: '''{
          "files": [
            {
              "pattern": "simple-pipeline/simple-app-files/*.tar",
              "target": "."
            }
          ]
    }''',
)
      }  
    }
    stage('Run artifact') {
      steps {
        
         echo "Checking java version"
              sh 'java -version'
              //sh '/home/jenkins/agent/workspace/artifactory-5.2_main'
              sh 'tar -xvf simple-app-files/app.tar'
              echo "Running artifact"
              //sh './app/bin/app'
      }
    }

  }

}